<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>手写一个 Vue 案例 | LQY前端文档</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="./public/OnePiece.png">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.5fdfbf9d.css" as="style"><link rel="preload" href="/assets/js/app.b5729c30.js" as="script"><link rel="preload" href="/assets/js/2.d59fc4a5.js" as="script"><link rel="preload" href="/assets/js/111.4d00a009.js" as="script"><link rel="prefetch" href="/assets/js/10.5b8bc10b.js"><link rel="prefetch" href="/assets/js/100.1e9a55f3.js"><link rel="prefetch" href="/assets/js/101.6a5fe770.js"><link rel="prefetch" href="/assets/js/102.50251d5e.js"><link rel="prefetch" href="/assets/js/103.5054c1f4.js"><link rel="prefetch" href="/assets/js/104.2d2763a1.js"><link rel="prefetch" href="/assets/js/105.e471785e.js"><link rel="prefetch" href="/assets/js/106.6da317d4.js"><link rel="prefetch" href="/assets/js/107.7442308b.js"><link rel="prefetch" href="/assets/js/108.45a84722.js"><link rel="prefetch" href="/assets/js/109.2f3fc2bf.js"><link rel="prefetch" href="/assets/js/11.1471fb3f.js"><link rel="prefetch" href="/assets/js/110.46f6fa46.js"><link rel="prefetch" href="/assets/js/112.177b2192.js"><link rel="prefetch" href="/assets/js/113.85e937aa.js"><link rel="prefetch" href="/assets/js/114.ea949574.js"><link rel="prefetch" href="/assets/js/115.401fcaee.js"><link rel="prefetch" href="/assets/js/116.a73b2619.js"><link rel="prefetch" href="/assets/js/117.d331e5f3.js"><link rel="prefetch" href="/assets/js/118.fa988135.js"><link rel="prefetch" href="/assets/js/119.07146eb3.js"><link rel="prefetch" href="/assets/js/12.723d77d1.js"><link rel="prefetch" href="/assets/js/120.3c2eb623.js"><link rel="prefetch" href="/assets/js/121.3f1cd234.js"><link rel="prefetch" href="/assets/js/122.dab65967.js"><link rel="prefetch" href="/assets/js/123.7c83f388.js"><link rel="prefetch" href="/assets/js/124.c8f250d6.js"><link rel="prefetch" href="/assets/js/125.4132b1e0.js"><link rel="prefetch" href="/assets/js/126.ddb5f86d.js"><link rel="prefetch" href="/assets/js/127.e2db6821.js"><link rel="prefetch" href="/assets/js/128.4693e75d.js"><link rel="prefetch" href="/assets/js/129.bd1f5d58.js"><link rel="prefetch" href="/assets/js/13.d358c593.js"><link rel="prefetch" href="/assets/js/130.95daee9d.js"><link rel="prefetch" href="/assets/js/131.87c436d5.js"><link rel="prefetch" href="/assets/js/132.de78c127.js"><link rel="prefetch" href="/assets/js/133.4c3e93b2.js"><link rel="prefetch" href="/assets/js/134.9ccf1969.js"><link rel="prefetch" href="/assets/js/135.1300b7f7.js"><link rel="prefetch" href="/assets/js/136.d4c4f1f1.js"><link rel="prefetch" href="/assets/js/137.b32f64b4.js"><link rel="prefetch" href="/assets/js/138.41a359c2.js"><link rel="prefetch" href="/assets/js/139.38a732c3.js"><link rel="prefetch" href="/assets/js/14.e38b1417.js"><link rel="prefetch" href="/assets/js/140.bd695800.js"><link rel="prefetch" href="/assets/js/15.e51c95d2.js"><link rel="prefetch" href="/assets/js/16.d416c2f5.js"><link rel="prefetch" href="/assets/js/17.cf6ac841.js"><link rel="prefetch" href="/assets/js/18.db67d4b5.js"><link rel="prefetch" href="/assets/js/19.869cbe19.js"><link rel="prefetch" href="/assets/js/20.60801485.js"><link rel="prefetch" href="/assets/js/21.0598acca.js"><link rel="prefetch" href="/assets/js/22.ec5222ba.js"><link rel="prefetch" href="/assets/js/23.6154f64f.js"><link rel="prefetch" href="/assets/js/24.7fb7796d.js"><link rel="prefetch" href="/assets/js/25.9ca97407.js"><link rel="prefetch" href="/assets/js/26.032e4a65.js"><link rel="prefetch" href="/assets/js/27.74853437.js"><link rel="prefetch" href="/assets/js/28.3e7057c1.js"><link rel="prefetch" href="/assets/js/29.5204cda7.js"><link rel="prefetch" href="/assets/js/3.c7d3605b.js"><link rel="prefetch" href="/assets/js/30.02f41df5.js"><link rel="prefetch" href="/assets/js/31.ca5355cc.js"><link rel="prefetch" href="/assets/js/32.57f096a4.js"><link rel="prefetch" href="/assets/js/33.3897c915.js"><link rel="prefetch" href="/assets/js/34.3cf51871.js"><link rel="prefetch" href="/assets/js/35.16637e94.js"><link rel="prefetch" href="/assets/js/36.e4191321.js"><link rel="prefetch" href="/assets/js/37.f515de3f.js"><link rel="prefetch" href="/assets/js/38.3c1e5dd3.js"><link rel="prefetch" href="/assets/js/39.79edaac3.js"><link rel="prefetch" href="/assets/js/4.9b22b136.js"><link rel="prefetch" href="/assets/js/40.21399269.js"><link rel="prefetch" href="/assets/js/41.49ed9bc0.js"><link rel="prefetch" href="/assets/js/42.db3b161a.js"><link rel="prefetch" href="/assets/js/43.efa803c4.js"><link rel="prefetch" href="/assets/js/44.38bfbe59.js"><link rel="prefetch" href="/assets/js/45.1571a945.js"><link rel="prefetch" href="/assets/js/46.9a3c4d14.js"><link rel="prefetch" href="/assets/js/47.197b4bee.js"><link rel="prefetch" href="/assets/js/48.03267513.js"><link rel="prefetch" href="/assets/js/49.c7478b8d.js"><link rel="prefetch" href="/assets/js/5.89b27e5c.js"><link rel="prefetch" href="/assets/js/50.a4d5f112.js"><link rel="prefetch" href="/assets/js/51.8849a460.js"><link rel="prefetch" href="/assets/js/52.df0b103e.js"><link rel="prefetch" href="/assets/js/53.7e489997.js"><link rel="prefetch" href="/assets/js/54.052059eb.js"><link rel="prefetch" href="/assets/js/55.c6a43ff7.js"><link rel="prefetch" href="/assets/js/56.7171b825.js"><link rel="prefetch" href="/assets/js/57.ccedaa27.js"><link rel="prefetch" href="/assets/js/58.699390d1.js"><link rel="prefetch" href="/assets/js/59.0445b099.js"><link rel="prefetch" href="/assets/js/6.e7875e59.js"><link rel="prefetch" href="/assets/js/60.d0d6c4f2.js"><link rel="prefetch" href="/assets/js/61.5680d4f8.js"><link rel="prefetch" href="/assets/js/62.57f421e1.js"><link rel="prefetch" href="/assets/js/63.50fd6104.js"><link rel="prefetch" href="/assets/js/64.a90bad22.js"><link rel="prefetch" href="/assets/js/65.bfbfa6a6.js"><link rel="prefetch" href="/assets/js/66.7bb3ce21.js"><link rel="prefetch" href="/assets/js/67.643bd8e1.js"><link rel="prefetch" href="/assets/js/68.da3cf703.js"><link rel="prefetch" href="/assets/js/69.a8f4f8ca.js"><link rel="prefetch" href="/assets/js/7.67d4b1a0.js"><link rel="prefetch" href="/assets/js/70.902d4425.js"><link rel="prefetch" href="/assets/js/71.b5d79cb7.js"><link rel="prefetch" href="/assets/js/72.36cbb3ac.js"><link rel="prefetch" href="/assets/js/73.6f53c4c0.js"><link rel="prefetch" href="/assets/js/74.fbfd9423.js"><link rel="prefetch" href="/assets/js/75.0f36be9b.js"><link rel="prefetch" href="/assets/js/76.77075714.js"><link rel="prefetch" href="/assets/js/77.131b8de8.js"><link rel="prefetch" href="/assets/js/78.fa0c788f.js"><link rel="prefetch" href="/assets/js/79.247e85cb.js"><link rel="prefetch" href="/assets/js/8.ee1e7a63.js"><link rel="prefetch" href="/assets/js/80.f425d555.js"><link rel="prefetch" href="/assets/js/81.3723e2db.js"><link rel="prefetch" href="/assets/js/82.1f85af03.js"><link rel="prefetch" href="/assets/js/83.3384356d.js"><link rel="prefetch" href="/assets/js/84.c3ac227c.js"><link rel="prefetch" href="/assets/js/85.35d1f71b.js"><link rel="prefetch" href="/assets/js/86.5cb2e78d.js"><link rel="prefetch" href="/assets/js/87.a6b5e648.js"><link rel="prefetch" href="/assets/js/88.8de44405.js"><link rel="prefetch" href="/assets/js/89.ee27b075.js"><link rel="prefetch" href="/assets/js/9.d2cb3534.js"><link rel="prefetch" href="/assets/js/90.c6884dc0.js"><link rel="prefetch" href="/assets/js/91.148bc864.js"><link rel="prefetch" href="/assets/js/92.96991118.js"><link rel="prefetch" href="/assets/js/93.076a3022.js"><link rel="prefetch" href="/assets/js/94.693e657b.js"><link rel="prefetch" href="/assets/js/95.c74f8ac0.js"><link rel="prefetch" href="/assets/js/96.ccfb2ab9.js"><link rel="prefetch" href="/assets/js/97.7252d54b.js"><link rel="prefetch" href="/assets/js/98.bb36008b.js"><link rel="prefetch" href="/assets/js/99.faeafb29.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5fdfbf9d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">LQY前端文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/document/document/introduce/" class="nav-link">
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/vue/basis/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/framework/react/basis/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件库" class="dropdown-title"><span class="title">组件库</span> <span class="arrow down"></span></button> <button type="button" aria-label="组件库" class="mobile-dropdown-title"><span class="title">组件库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://element.eleme.cn/#/zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  element ui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.antdv.com/docs/vue/introduce-cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ant desgin of vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vuetifyjs.com/en/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuetify
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://bootstrap-vue.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bootstrap-vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vux.li/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vux
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://iview.talkingdata.com/#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  iView
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://muse-ui.org/#/zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  muse-ui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          React
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://ant.design/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ant desgin of react
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/InterviewBible/byte/basis/" class="nav-link">
  面试宝典
</a></div><div class="nav-item"><a href="/consulting/frontEnd/reactNoTypescript/" class="nav-link">
  不知道的冷知识
</a></div><div class="nav-item"><a href="https://github.com/LQYld" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/document/document/introduce/" class="nav-link">
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/vue/basis/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/framework/react/basis/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="组件库" class="dropdown-title"><span class="title">组件库</span> <span class="arrow down"></span></button> <button type="button" aria-label="组件库" class="mobile-dropdown-title"><span class="title">组件库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://element.eleme.cn/#/zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  element ui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.antdv.com/docs/vue/introduce-cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ant desgin of vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vuetifyjs.com/en/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuetify
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://bootstrap-vue.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bootstrap-vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vux.li/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vux
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://iview.talkingdata.com/#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  iView
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://muse-ui.org/#/zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  muse-ui
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          React
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://ant.design/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ant desgin of react
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/InterviewBible/byte/basis/" class="nav-link">
  面试宝典
</a></div><div class="nav-item"><a href="/consulting/frontEnd/reactNoTypescript/" class="nav-link">
  不知道的冷知识
</a></div><div class="nav-item"><a href="https://github.com/LQYld" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>介绍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>生态</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>扩展</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>源码解析</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/framework/vue/CodeParsing/" aria-current="page" class="sidebar-link">Vue 2.0 源码解析</a></li><li><a href="/framework/vue/CodeParsing/DistributionSubscriptionModel/" aria-current="page" class="active sidebar-link">手写一个 Vue 案例</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue性能优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="手写一个-vue-案例"><a href="#手写一个-vue-案例" class="header-anchor">#</a> 手写一个 Vue 案例</h1> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>没有使用过Vue完成真实项目不推荐直接研究源码原理，此案例中只包含了，发布订阅模式及虚拟Dom简化转换、映射代理。<br>
不包含，patch算法及全局API等内置功能。</p></div> <h2 id="设置基础-html-页面"><a href="#设置基础-html-页面" class="header-anchor">#</a> 设置基础 html 页面</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {{name}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./lqyvue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LQYvue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            el<span class="token operator">:</span><span class="token string">'#root'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span><span class="token punctuation">{</span>
                name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
                age<span class="token operator">:</span><span class="token number">14</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="封装工具函数"><a href="#封装工具函数" class="header-anchor">#</a> 封装工具函数</h2> <p><strong>插值正则</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> RegSolt <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\{\{(.+?)\}\}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">解析</p> <p>用来替换 html 中所设置的插值表达式。</p></div> <p><strong>解析简单路径</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getValueByPath</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> paths <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> obj<span class="token punctuation">;</span>
  <span class="token keyword">let</span> prop<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>prop <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res <span class="token operator">=</span> res<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">解析</p> <p>接受参数 obj(根节点)、path(路径)。<br>
通过 split 方法将路径转换为数组，再利用 while 循环一层一层的访问路径下的字段值。<br>
例如：a.b.c 会解析该路径获取到 a.b 下的 c 的值。</p></div> <h2 id="lqyvue-实例"><a href="#lqyvue-实例" class="header-anchor">#</a> LQYvue 实例</h2> <p><strong>创建 LQYvue 实例</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">LQYvue</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token operator">=</span> options<span class="token punctuation">.</span>data<span class="token punctuation">;</span> <span class="token comment">// 响应式数据</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取真实Dom 用于生成虚拟Dom</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span> <span class="token comment">// 获取真实Dom的父级元素</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 渲染挂载</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th>LQYvue</th> <th>options</th> <th>作用</th></tr></thead> <tbody><tr><td>this._data</td> <td>options.data</td> <td>需要响应式化的数据</td></tr> <tr><td>this.el</td> <td>options.el</td> <td>获取传入的ID值获取真实Dom元素</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">解析</p> <ul><li>this.parent = this.el.parentNode 为了获取真实Dom的父级元素。</li> <li>this.mount() 开始进行页面渲染挂载。<br><br>
以上3个的作用，这里不做详细解析，下面进行编写的时候会详细解析。</li></ul></div> <p><strong>缓存 抽象语法树</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">LQYvue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createRenderFn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token function">getVNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">replaceSolt</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">解析</p> <ul><li>getVNode() 需要传入一个 真实Dom 将 真实Dom 转换为 虚拟Dom。</li> <li>replaceSolt() 需要传入 虚拟Dom 及 数据 转换为 已经将插值替换了的 虚拟Dom
<br> <br>
这里使用到了函数闭包、函数柯里化等知识，将还有插值表达式，还没进行替换的虚拟Dom进行缓存。</li></ul></div> <p><strong>渲染挂载</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">LQYvue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createRenderFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">解析</p> <p>this.render 为 已经将插值替换了的虚拟Dom</p></div> <p><strong>这是挂载函数</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">LQYvue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">mountComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">解析</p> <p>这里先直接调用 LQYvue 实例的 update 方法进行 页面更新。之后会接入数据驱动视图的思想重新改写。</p></div> <p><strong>更新视图</strong></p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>页面更新 简化，省略 diff 算法。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">LQYvue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">realDOM</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>
    <span class="token function">parseVNode</span><span class="token punctuation">(</span>realDOM<span class="token punctuation">)</span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">解析</p> <ul><li>parseVNode(realDOM) 传入虚拟Dom 转换为 真实 Dom。<br>
这个时候 realDOM 为已经进行插值替换了的 虚拟Dom。
<br>
使用 原生 Dom 操作 replaceChild 方法，将原始页面中的 Dom 元素进行替换。</li></ul></div> <h2 id="vnode-实例"><a href="#vnode-实例" class="header-anchor">#</a> VNode 实例</h2> <p><strong>创建 VNode</strong></p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>之后的讲述都会以 VNode 表示 虚拟Dom，方便理解代码思路及编写。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">VNode</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> value<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag <span class="token operator">&amp;&amp;</span> tag<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 虚拟 Dom 的标签</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span> <span class="token comment">// 静态属性</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token comment">// 文本内容</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span> <span class="token comment">// 节点类型</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 子节点</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th>VNode</th> <th>options</th> <th>作用</th></tr></thead> <tbody><tr><td>this.tag</td> <td>tag</td> <td>节点的标签名称，这里统一进行了小写转换处理</td></tr> <tr><td>this.data</td> <td>data</td> <td>节点的静态属性 比如 id type class 等</td></tr> <tr><td>this.value</td> <td>value</td> <td>节点的文本内容</td></tr> <tr><td>this.type</td> <td>type</td> <td>节点的类型</td></tr> <tr><td>this.children</td> <td>children</td> <td>子节点集合，用数组的方式存储当前节点的儿子节点</td></tr></tbody></table> <p><strong>添加子节点</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 为 当前 虚拟 Dom 子节点</span>
<span class="token class-name">VNode</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">appendChild</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token parameter">VNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>VNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><h2 id="getvnode、replacesolt、parsevnode方法"><a href="#getvnode、replacesolt、parsevnode方法" class="header-anchor">#</a> getVNode、replaceSolt、parseVNode方法</h2> <p><strong>getVNode 将真实Dom 转换为 VNode</strong></p> <div class="custom-block tip"><p class="custom-block-title">导读</p> <p>在阅读代码封装之前，先罗列出即将使用到元素节点自身的DOM方法。</p> <table><thead><tr><th>Function</th> <th>作用</th> <th>说明</th></tr></thead> <tbody><tr><td>Node.nodeType</td> <td>获取节点类型</td> <td>节点类型分为元素节点、文本节点、注释节点，不同类型的节点的创建方式不同</td></tr> <tr><td>Node.attributes</td> <td>获取节点静态类型集合</td> <td>获取的格式如:[{nodeName:id,nodeValue:root}]</td></tr> <tr><td>Node.nodeName</td> <td>获取节点标签名称</td> <td>可能获取到的表情名称会全大写的情况，例如 DIV 所以在 VNode 实例进行了全小写操作</td></tr> <tr><td>Node.childNodes</td> <td>获取子节点集合</td> <td>获取该节点下子节点集合</td></tr></tbody></table></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getVNode</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _vnode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 创建空元素，用于后面赋值存储当前 VNode节点实例</span>
 <span class="token comment">// 利用 switch case 对不同类型的节点进行处理，这里简化只对 元素节点及文本节点进行处理</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      <span class="token comment">// 当前节点类型为 元素节点</span>
      <span class="token keyword">let</span> _attrObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 创建 空对象 用于存储节点的静态属性</span>
      <span class="token comment">// 对 静态属性集合进行循环赋值处理</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> element<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        _attrObj<span class="token punctuation">[</span>element<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName<span class="token punctuation">]</span> <span class="token operator">=</span>
          element<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 创建 VNode</span>
      <span class="token comment">// 因为是 元素节点 所以不需要传入 文本信息</span>
      _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>
        element<span class="token punctuation">.</span>nodeName<span class="token punctuation">,</span>
        _attrObj<span class="token punctuation">,</span>
        <span class="token keyword">undefined</span><span class="token punctuation">,</span>
        element<span class="token punctuation">.</span>nodeType
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 获取 该节点的子节点集合并循环，如果存在子节点进行 递归处理</span>
      <span class="token comment">// 并将生成的 VNode 调用之前封装的appendChild 存储当前 VNode 子节点集合当中</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> element<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _vnode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">getVNode</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归生成虚拟 DOM</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
      <span class="token comment">// 当前节点类型为 文本节点</span>
      <span class="token comment">// 文本节点 只有文本信息并且不存在子节点</span>
      <span class="token comment">// 所以 只需要传入 文本内容及节点类型即可</span>
      _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>
        <span class="token keyword">undefined</span><span class="token punctuation">,</span>
        <span class="token keyword">undefined</span><span class="token punctuation">,</span>
        element<span class="token punctuation">.</span>nodeValue<span class="token punctuation">,</span>
        element<span class="token punctuation">.</span>nodeType
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> _vnode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>replaceSolt 将 VNode中的插值表达式与数据相互替换</strong></p> <div class="custom-block tip"><p class="custom-block-title">导读</p> <ul><li>RegSolt 为 工具函数是 提前封装好的 {{}} 插值正则</li> <li>getValueByPath 为之前封装好的解析简单路径的工具函数<br> <br> <strong>String.replace(RegSolt, function (_, g) {
return getValueByPath(data, g.trim())
})</strong><br><br>
replace() 方法返回一个由替换值（replacement）替换部分或所有的模式（pattern）匹配项后的新字符串。模式可以是一个字符串或者一个正则表达式，替换值可以是一个字符串或者一个每次匹配都要调用的回调函数。如果pattern是字符串，则仅替换第一个匹配项。</li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">replaceSolt</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里接收了传入的 VNode</span>
  <span class="token comment">// data 指的是 LQYvue 实例中 this._data 的响应式数据的值</span>
  <span class="token keyword">let</span> _tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag<span class="token punctuation">;</span>
  <span class="token keyword">let</span> _type <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
  <span class="token keyword">let</span> _data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">let</span> _value <span class="token operator">=</span> vnode<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">let</span> _children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token keyword">let</span> _vnode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">// 这里的操作大体与 getVNode 方法的操作思路是一样的</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>_type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>_tag<span class="token punctuation">,</span> _data<span class="token punctuation">,</span> _value<span class="token punctuation">,</span> _type<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 如果有子节点存在 则 递归调用 replaceSolt 方法</span>
      _children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_subvnode</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        _vnode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">replaceSolt</span><span class="token punctuation">(</span>_subvnode<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
      <span class="token comment">// 这一步，插值替换的操作就来了</span>
      <span class="token comment">// 使用 正则的办法，匹配到 文本中 {{}} 中的内容</span>
      <span class="token comment">// 例如 {{name}}</span>
      _value <span class="token operator">=</span> _value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>RegSolt<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> g</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// g 就是 之前 举例中的 name 使用 trim 方法剔除前后空格</span>
        <span class="token comment">// 再调用 getValueByPath进行路径解析获取 name 的值</span>
        <span class="token comment">// return 的值 会替换文本中 的值</span>
        <span class="token comment">// 例如 {{name}} 会被替换为 张三</span>
        <span class="token keyword">return</span> <span class="token function">getValueByPath</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> g<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>_tag<span class="token punctuation">,</span> _data<span class="token punctuation">,</span> _value<span class="token punctuation">,</span> _type<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> _vnode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>parseVNode 将已经进行插值替换的 VNode转为 真实Dom</strong></p> <div class="custom-block tip"><p class="custom-block-title">导读</p> <p>在阅读代码封装之前，先罗列出即将使用到操作DOM的方法。</p> <table><thead><tr><th>Function</th> <th>作用</th> <th>说明</th></tr></thead> <tbody><tr><td>document.createElement</td> <td>创建元素节点</td> <td>document.createElement(标签名)</td></tr> <tr><td>document.createTextNode</td> <td>创建文本节点</td> <td>document.createTextNode(文本内容)</td></tr> <tr><td>Node.setAttribute</td> <td>为该节点设置属性</td> <td>Node.setAttribute(属性名, 属性值)</td></tr> <tr><td>Node.appendChild</td> <td>压入子元素</td> <td>Node.appendChild(元素节点)</td></tr></tbody></table></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">parseVNode</span><span class="token punctuation">(</span><span class="token parameter">VNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _node <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 初始化真实 DOM</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>VNode<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      <span class="token comment">// 如果是 元素节点 创建 元素</span>
      _node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>VNode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 绑定属性</span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> VNode<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token comment">// 循环为该元素添加静态属性</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> attrName <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword">let</span> attrValue <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        _node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>attrName<span class="token punctuation">,</span> attrValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 如果子元素存在，则递归调用 parseVNode 方法</span>
      <span class="token comment">// 在将子元素压入改元素当中</span>
      <span class="token keyword">let</span> children <span class="token operator">=</span> VNode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
      children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">subvnode</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        _node<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">parseVNode</span><span class="token punctuation">(</span>subvnode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
      <span class="token comment">// 如果是 文本节点 直接创建 文本元素</span>
      <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>VNode<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建文本节点</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> _node<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>之前的代码，我们已经设置好了 LQYvue实例、VNode实例、工具函数及虚拟Dom与真实Dom相互转换的方法，
将他们相互关联起来，实现了VNode渲染视图的作用。但是还没有将数据响应式，实现数据驱动视图，
下面我们将引入 Watcher、Dep、Observe，添加发布订阅模式，实现数据驱动视图</p> <h2 id="observe-数据响应式"><a href="#observe-数据响应式" class="header-anchor">#</a> Observe 数据响应式</h2> <p><strong>observe</strong></p> <div class="custom-block tip"><p class="custom-block-title">导读</p> <p><strong>Object.keys(obj)</strong><br>
返回该对象的可枚举属性数组。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 这里参数进行了判断，先忽略对数组进行响应式拦截，</span>
   <span class="token comment">// 因为数组的 push 等方法，不会触发 getter setter 的所以之后我们会对数组进行单独处理</span>
   <span class="token comment">// 再现暂时忽略</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可枚举属性数组</span>
    <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> prop <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 属性名</span>
      <span class="token comment">// 调用defineReactive使其数据响应式化</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>defineReactive</strong></p> <div class="custom-block tip"><p class="custom-block-title">导读</p> <p><strong>Object.defineProperty(obj, prop, descriptor)</strong></p> <table><thead><tr><th>descriptor</th> <th>默认值</th> <th>说明</th></tr></thead> <tbody><tr><td>configurable</td> <td>false</td> <td>当为true的时候，该属性的描述符才能够被改变，同时该属性也能从对应的对象上被删除</td></tr> <tr><td>enumberable</td> <td>false</td> <td>当为true的时候，该属性才会出现在对象的可枚举属性中</td></tr> <tr><td>value</td> <td>undefined</td> <td>该属性对应的值</td></tr> <tr><td>writable</td> <td>false</td> <td>当为true的时候，才能被赋值运算符改变</td></tr> <tr><td>get</td> <td>undefined</td> <td>当访问该属性时，会调用此函数</td></tr> <tr><td>set</td> <td>undefined</td> <td>当设置该属性时，会调用此函数</td></tr></tbody></table></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> enumberable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里进行了一次判断，</span>
  <span class="token comment">// 如果是 对象类型 则递归调用 observe 方法</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 这里将该属性 响应式化</span>
  <span class="token comment">// 当访问或设置 该属性值的时候，会触发 getter setter</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    enumberable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumberable<span class="token punctuation">,</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 在设置的值的时候，判断新值是否是对象类型，如果是对象类型则递归调用observe</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> newVal <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> newVal <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      value <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>LQYvue实例添加initData</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">LQYvue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">initData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 将传入的数据 进行 响应式化处理</span>
  <span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 这里获取了 this._data 中的所有属性名</span>
  <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 循环调用传入 proxy 函数</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;_data&quot;</span><span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>映射代理</strong></p> <div class="custom-block tip"><p class="custom-block-title">导读</p> <p>为LQYvue实例上绑定映射代理<br>
因为在js设计规范中，_符号开头的属性通常表示为私有属性，是不允许被访问的<br>
所以设置映射代理使 this.name 可以直接访问到 this._data.name</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>LQYvue实例初始化时调用initData</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">LQYvue</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token operator">=</span> options<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>
  <span class="token comment">// 新增</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 数据响应式化</span>
  <span class="token comment">//</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><h2 id="小结-2"><a href="#小结-2" class="header-anchor">#</a> 小结</h2> <p>之前的代码，我们引入了 observe 将数据进行了响应式化，现在还缺少的问题就是，数据改变了，如何更新页面，这里将简化实现 Vue中的核心概念，发布订阅模式。</p> <h2 id="发布订阅模式"><a href="#发布订阅模式" class="header-anchor">#</a> 发布订阅模式</h2> <div class="custom-block tip"><p class="custom-block-title">分析</p> <p><strong>发布订阅大体思路</strong> <br>
为每一个响应式数据，创建一个 唯一的 Dep 实例，当数据被访问的时候，Dep会开始收集依赖，表示这些数据被使用到了，当数据发生改变的时候，将通知 Watcher 派发更新<br>
在 Vue 的源码当中，Watcher 可以看做为，一个组件就是一个 Watcher，会通知 使用到该数据的组件进行 更新，就不会 将页面全部替换。</p></div> <h3 id="dep"><a href="#dep" class="header-anchor">#</a> Dep</h3> <div class="custom-block tip"><p class="custom-block-title">导读</p> <p>这里 使 Dep 与 Watcher 进行了 双向关联。</p></div> <p><strong>创建Dep实例</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> depid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Dep</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> depid<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 未 Dep 设置</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 存储相关联的 Watcher</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/framework/vue/CodeParsing/" class="prev router-link-active">
        Vue 2.0 源码解析
      </a></span> <span class="next"><a href="/framework/vue/optimization/correctUseThis/">
        Vue 中避免滥用 this 去读取 data 中数据
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b5729c30.js" defer></script><script src="/assets/js/2.d59fc4a5.js" defer></script><script src="/assets/js/111.4d00a009.js" defer></script>
  </body>
</html>
