(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{430:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"重排与重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重排与重绘"}},[t._v("#")]),t._v(" 重排与重绘")]),t._v(" "),s("h2",{attrs:{id:"重绘-repaint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重绘-repaint"}},[t._v("#")]),t._v(" 重绘（Repaint）")]),t._v(" "),s("p",[t._v("重绘是一个元素外观的改变所触发的浏览器行为，例如改变 outline、背景颜色等属性。浏览器会根据元素的新属性重新绘制，使元素呈现新的外观。重绘不会带来重新布局，所以并不一定伴随重排。"),s("br"),s("br")]),t._v(" "),s("p",[t._v("需要注意的是：重绘是以图层为单位，如果图层中的某个元素需要重绘，那么整个图层都需要重绘。"),s("br"),t._v("\n所以为了提高性能，我们应该让这些 “变化的东西” 拥有一个自己一个图层。"),s("br"),t._v("\n不过好在绝大多数的浏览器自己会为 CSS3 动画的节点自动创建图层。")]),t._v(" "),s("h2",{attrs:{id:"重排-reflow-又称-回流"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重排-reflow-又称-回流"}},[t._v("#")]),t._v(" 重排（Reflow 又称：回流）")]),t._v(" "),s("p",[t._v("渲染对象在创建完成并添加到渲染树时，并不包含位置和大小信息。计算这些值的过程称为布局或重排。"),s("br"),s("br"),t._v('\n"重绘"不一定需要"重排"，比如改变某个网页元素的颜色，就只会触发"重绘"，不会触发"重排"，因为布局没有改变。'),s("br"),t._v('\n"重排"大多数情况下会导致"重绘"，比如改变一个网页元素的位置，就会同时触发"重排"和"重绘"，因为布局改变了。')]),t._v(" "),s("h2",{attrs:{id:"触发重绘的属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#触发重绘的属性"}},[t._v("#")]),t._v(" 触发重绘的属性")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("属性名")]),t._v(" "),s("th",[t._v("属性名")]),t._v(" "),s("th",[t._v("属性名")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("color")]),t._v(" "),s("td",[t._v("background")]),t._v(" "),s("td",[t._v("outline-color")])]),t._v(" "),s("tr",[s("td",[t._v("border-style")]),t._v(" "),s("td",[t._v("background-image")]),t._v(" "),s("td",[t._v("outline")])]),t._v(" "),s("tr",[s("td",[t._v("border-radius")]),t._v(" "),s("td",[t._v("background-position")]),t._v(" "),s("td",[t._v("outline-style")])]),t._v(" "),s("tr",[s("td",[t._v("visibility")]),t._v(" "),s("td",[t._v("background-repeat")]),t._v(" "),s("td",[t._v("outline-width")])]),t._v(" "),s("tr",[s("td",[t._v("text-decoration")]),t._v(" "),s("td",[t._v("background-size")]),t._v(" "),s("td",[t._v("box-shadow")])])])]),t._v(" "),s("h2",{attrs:{id:"触发重排-回流-的属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#触发重排-回流-的属性"}},[t._v("#")]),t._v(" 触发重排（回流）的属性")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("属性名")]),t._v(" "),s("th",[t._v("属性名")]),t._v(" "),s("th",[t._v("属性名")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("width")]),t._v(" "),s("td",[t._v("top")]),t._v(" "),s("td",[t._v("text-aligin")])]),t._v(" "),s("tr",[s("td",[t._v("height")]),t._v(" "),s("td",[t._v("bottom")]),t._v(" "),s("td",[t._v("overflow-y")])]),t._v(" "),s("tr",[s("td",[t._v("padding")]),t._v(" "),s("td",[t._v("left")]),t._v(" "),s("td",[t._v("font-weight")])]),t._v(" "),s("tr",[s("td",[t._v("margin")]),t._v(" "),s("td",[t._v("right")]),t._v(" "),s("td",[t._v("overflow")])]),t._v(" "),s("tr",[s("td",[t._v("display")]),t._v(" "),s("td",[t._v("position")]),t._v(" "),s("td",[t._v("font-family")])]),t._v(" "),s("tr",[s("td",[t._v("border-width")]),t._v(" "),s("td",[t._v("float")]),t._v(" "),s("td",[t._v("line-height")])]),t._v(" "),s("tr",[s("td",[t._v("border")]),t._v(" "),s("td",[t._v("clear")]),t._v(" "),s("td",[t._v("vertival-align")])]),t._v(" "),s("tr",[s("td",[t._v("min-height")]),t._v(" "),s("td"),t._v(" "),s("td")])])]),t._v(" "),s("h2",{attrs:{id:"常见的触发重排的操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见的触发重排的操作"}},[t._v("#")]),t._v(" 常见的触发重排的操作")]),t._v(" "),s("p",[t._v("Reflow（重排）的成本比 Reqaint（重绘）的成本高很多。"),s("br"),t._v("\n一个节点的 Reflow 很多可能导致子节点，甚至父点以及同级节点的 Reflow。"),s("br"),t._v("\n在一些高性能的电脑上也许还没有什么，但是如果 Reflow 发生在手机上，那么这个过程是非常痛苦和耗电的。"),s("br"),s("br"),t._v("\n所以，下面这些动作很大可能会是成本比较高的。")]),t._v(" "),s("ul",[s("li",[t._v("当增加、删除、修改 DOM 节点时，会导致 Reflow,Repaint")]),t._v(" "),s("li",[t._v("当移动 DOM 的位置")]),t._v(" "),s("li",[t._v("当修改 CSS 样式的时候")]),t._v(" "),s("li",[t._v("当 Resize 窗口的时候（移动端没有这个问题，因为移动端的缩放没有影响布局视图）")]),t._v(" "),s("li",[t._v("当修改网页的默认字体时。")]),t._v(" "),s("li",[t._v("获取某些属性时（width,height...）"),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("display:none 会触发 reflow， 而 visibility:hidden 只会触发 repaint,因为没有发生位置变化。")])])])]),t._v(" "),s("h2",{attrs:{id:"优化方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化方案"}},[t._v("#")]),t._v(" 优化方案")]),t._v(" "),s("p",[t._v("我们已知：浏览器渲染页面时经历了如下“细致”的环境")]),t._v(" "),s("ul",[s("li",[s("ol",[s("li",[t._v("计算需要被加载到节点上的样式结果（Recalculate style--样式重计算）")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"2"}},[s("li",[t._v("为每个节点生成图形和位置（Layout--重排或回流）")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"3"}},[s("li",[t._v("将每个节点填充到图层中（Paint--重绘）")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"4"}},[s("li",[t._v("组合图层到页面上（Composite Layers--图层重组）")])])])]),t._v(" "),s("p",[t._v("如果需要提升性能，需要做的就是减少浏览器在运行时所需要做的工作。")]),t._v(" "),s("h3",{attrs:{id:"具体优化方案如下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#具体优化方案如下"}},[t._v("#")]),t._v(" 具体优化方案如下")]),t._v(" "),s("ul",[s("li",[s("ol",[s("li",[t._v("元素位置移动变换时尽量使用 CSS3 的 transform 来代替对 top left 等的操作。变换（transform）和透明度（opacity）的改变仅仅影响图层的组合")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"2"}},[s("li",[t._v("【使用 opacity 来代替 visibility】")])]),t._v(" "),s("ul",[s("li",[t._v("(1) 使用 visibility 不触发重排，但是依然重绘。")]),t._v(" "),s("li",[t._v("(2) 直接使用 opacity 即触发重绘，又触发重排（GPU 底层设计如此）")]),t._v(" "),s("li",[t._v("(3) opacity 配合图层使用，即不触发重绘也不触发重排。透明度的改变时，GPU 在绘画时只是简单的降低之前已经画好的纹理的 alpha 值来达到效果，并不需要整体的重绘，不过这个前提时这个被修改的 opacity 本身必须是一个图层。")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"3"}},[s("li",[t._v("【不要使用 table 布局】")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"4"}},[s("li",[t._v("将【多次改变样式属性的操作合并成一次】操作。不要一条一条地修改 DOM 的样式，预先定义好 class ，然后修改 DOM 的 className")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"5"}},[s("li",[t._v("【将 DOM 离线后再修改】，由于 display 属性为 none 的元素不在渲染树中，对隐藏的元素操作不会引发其他元素的重排。如果要对一个元素进行复杂的操作时，可以先隐藏它，操作完成后再显示。这样只在隐藏和显示时触发 2 次重排。")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"6"}},[s("li",[t._v("【利用文档碎片】（documentFragment）-----vue 使用了该方式 提升性能")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"7"}},[s("li",[t._v("【不要把获取某些 DOM 节点的属性放在一个循环里当成循环的变量】当你请求向浏览器请求一些 style 信息的时候，就会让浏览器 flush 队列，比如：")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("(1) offsetTop,offsetLeft,offsetWidth,offsetHeight")])]),t._v(" "),s("li",[s("p",[t._v("(2) scrollTop/Left/Width/Height")])]),t._v(" "),s("li",[s("p",[t._v("(3) clientTop/Left/Width/Height")])]),t._v(" "),s("li",[s("p",[t._v("(4) width,heigh")]),t._v(" "),s("p",[t._v("当你请求上面的一些属性的时候，浏览器为了给你最精确的值，需要刷新内部队列。因为队列中可能会有影响到这些值的操作。即使你获取元素的布局和样式信息跟最近发生或改变的布局信息无关，浏览器都会强行刷新渲染队列。")])])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"8"}},[s("li",[t._v("动画实现过程中，启用 GPU 硬件加速：transform:tranlateZ(0)")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"9"}},[s("li",[t._v("为动画元素新建图层，提高动画元素的 z-index")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"10"}},[s("li",[t._v("编写动画时，尽量使用如下的 API")])])])]),t._v(" "),s("h3",{attrs:{id:"requestanimationframe-请求动画帧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#requestanimationframe-请求动画帧"}},[t._v("#")]),t._v(" requestAnimationFrame----请求动画帧")]),t._v(" "),s("ul",[s("li",[s("ol",[s("li",[t._v("window.requestAnimationFrame()。说明：该方法会告诉浏览器在下一次重绘重排之前调用你所指定的函数")])]),t._v(" "),s("ul",[s("li",[s("ol",[s("li",[t._v("参数：该方法使用一个回调函数作为参数，这个回调函数会在浏览器下一次重绘之前调用。回调函数会被自动传入一个参数，DOMHighResTimeStamp,标识 requestAnimationFrame()开始触发回调函数的当前时间。")])])]),t._v(" "),s("li",[s("ol",{attrs:{start:"2"}},[s("li",[t._v("返回值：一个 long 整数，请求 ID ，是回调列表中唯一的标识。是个非零值，没别的意义。你可以传这个值给 window.cancelAnimationFrame(requestID)")])])])]),t._v(" "),s("p",[t._v("备注：若你想在浏览器下次重绘之前继续更新下帧动画，那么回调函数自身必须再次调用 window.requestAnimationFrame()")])]),t._v(" "),s("li",[s("ol",{attrs:{start:"2"}},[s("li",[t._v("window.cancelAnimationFrame(requestID)。取消一个先前通过调用 window.requestAnimationFrame()方法添加到计划中的动画帧请求。requestID 是先前调用 window.requestAnimationFrame()方法时返回的值，它是一个时间标识，用法与定时器的 id 类似。")])])])]),t._v(" "),s("p",[t._v("例")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" test "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" index "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("move")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transform "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("translateX(")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("index"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("px)")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("move"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("move"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 两秒后动画要停止")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cancelAnimationFrame")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);