(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{424:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"浏览器渲染引擎与阻塞"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器渲染引擎与阻塞"}},[t._v("#")]),t._v(" 浏览器渲染引擎与阻塞")]),t._v(" "),a("h2",{attrs:{id:"一、浏览器渲染引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、浏览器渲染引擎"}},[t._v("#")]),t._v(" 一、浏览器渲染引擎")]),t._v(" "),a("h3",{attrs:{id:"主要模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主要模块"}},[t._v("#")]),t._v(" 主要模块")]),t._v(" "),a("h4",{attrs:{id:"一个渲染引擎主要包括-html-解析器-css-解析器-javascript-引擎-布局-layout-模块-绘图模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一个渲染引擎主要包括-html-解析器-css-解析器-javascript-引擎-布局-layout-模块-绘图模块"}},[t._v("#")]),t._v(" 一个渲染引擎主要包括：HTML 解析器，CSS 解析器，javascript 引擎，布局 layout 模块，绘图模块")]),t._v(" "),a("ul",[a("li",[t._v("HTML 解析器：解析 HTML 文档的解析器，主要作用是将 HTML 文本解析成 DOM 树。")]),t._v(" "),a("li",[t._v("CSS 解析器：它的作用是为 DOM 中的各个元素对象计算出样式信息，为布局提供基础设施。")]),t._v(" "),a("li",[t._v("Javascript 引擎：使用 Javascript 代码可以修改网页的内容，也能修改 css 的信息。")]),t._v(" "),a("li",[t._v("布局（layout）:在 DOM 创建之后，Webkit 需要将其中的元素对象同样式信息结合起来，计算他们的大小位置等布局信息，形成一个能表达这所有的页面布局。")]),t._v(" "),a("li",[t._v("绘图模块（paint）：使用图形库将布局计算后的各个网页的节点绘制成图像结果")])]),t._v(" "),a("p",[t._v("备注：文档对象模型（Document Object Model , 简称 DOM）")]),t._v(" "),a("h3",{attrs:{id:"大致的渲染过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大致的渲染过程"}},[t._v("#")]),t._v(" 大致的渲染过程")]),t._v(" "),a("h4",{attrs:{id:"浏览器渲染页面的整个过程-浏览器会从上到下解析文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器渲染页面的整个过程-浏览器会从上到下解析文档"}},[t._v("#")]),t._v(" 浏览器渲染页面的整个过程：浏览器会从上到下解析文档")]),t._v(" "),a("ul",[a("li",[t._v("遇见 HTML 标记，调用 HTML 解析器解析为对应的 token（一个 token 就是一个标签文本的序列化）并构建 DOM 树（就是一块内存，保存着 token）。")]),t._v(" "),a("li",[t._v("遇见 style/link 标记调用相应解构器处理 CSS 标记，并构建出 CSS 样式树。")]),t._v(" "),a("li",[t._v("遇见 scrpit 标记 调用 javascript 引擎 处理 script 标记、绑定事件、修改 DOM 树/CSS 树等。")]),t._v(" "),a("li",[t._v("将 DOM 树 与 CSS 树 合并成一个渲染树。")]),t._v(" "),a("li",[t._v("根据渲染树来渲染，以计算每个节点的几何信息（这一过程需要依赖 GPU）。")]),t._v(" "),a("li",[t._v("最终将各个节点绘制到屏幕上。")])]),t._v(" "),a("p",[t._v("以上这些模块依赖很多其他的基础模块，包括要使用到网络 存储 2D/3D 图像 音频视频解码器 和 图片解码器。"),a("br"),t._v("\n所以渲染引擎中还会包括如何使用这些依赖模块的部分。")]),t._v(" "),a("h4",{attrs:{id:"parse-html-解析器-是异步解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parse-html-解析器-是异步解析"}},[t._v("#")]),t._v(" Parse HTML 解析器 是异步解析")]),t._v(" "),a("h3",{attrs:{id:"style-样式渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#style-样式渲染"}},[t._v("#")]),t._v(" style 样式渲染")]),t._v(" "),a("ul",[a("li",[t._v("style 标签中的样式由 html 解析器进行解析。")]),t._v(" "),a("li",[t._v('页面 style 标签书写的内部样式是异步解析的（容易产生"闪屏"现象）。')]),t._v(" "),a("li",[t._v("浏览器加载资源是异步的。")])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),a("p",[t._v("禁止使用 style 标签来书写页面样式，避免闪屏现象。")])]),t._v(" "),a("h3",{attrs:{id:"link-样式的渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#link-样式的渲染"}},[t._v("#")]),t._v(" link 样式的渲染")]),t._v(" "),a("ul",[a("li",[t._v("link 进来的样式，是由 css 解析器去解析，并且是同步解析的。")]),t._v(" "),a("li",[t._v("css 解析器会阻塞页面的渲染。（也可以说 link 进来的外部样式会阻塞页面渲染，利用他避免闪屏）。")]),t._v(" "),a("li",[t._v("推荐使用 link 方式去引入样式。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("推荐")]),t._v(" "),a("p",[t._v("解决 css 解析器时间过长问题，设置加载动画图，动画图会在 解析 HTML 完成时展示出来。")])]),t._v(" "),a("h4",{attrs:{id:"parse-stylesheet-解析器-是同步解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parse-stylesheet-解析器-是同步解析"}},[t._v("#")]),t._v(" Parse Stylesheet 解析器 是同步解析")]),t._v(" "),a("h2",{attrs:{id:"二、阻塞渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、阻塞渲染"}},[t._v("#")]),t._v(" 二、阻塞渲染")]),t._v(" "),a("h3",{attrs:{id:"_1-关于-css-阻塞"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-关于-css-阻塞"}},[t._v("#")]),t._v(" 1.关于 css 阻塞：")]),t._v(" "),a("p",[t._v("声明：只有 link 引入的外部 css 才能够产生阻塞。")]),t._v(" "),a("ul",[a("li",[t._v("1.style 标签中的样式\n"),a("ul",[a("li",[t._v("由 html 解析器进行解析")]),t._v(" "),a("li",[t._v("不阻塞浏览器渲染（可能会产生”闪屏现象“）")]),t._v(" "),a("li",[t._v("不阻塞 DOM 解析")])])]),t._v(" "),a("li",[t._v("2.link 引入的外部 css 样式（推荐使用的方式）\n"),a("ul",[a("li",[t._v("由 css 解析器进行解析")]),t._v(" "),a("li",[t._v("阻塞浏览器渲染（可以利用这种阻塞避免”闪屏现象“）")]),t._v(" "),a("li",[t._v("阻塞其后面的 js 语句的执行")]),t._v(" "),a("li",[t._v("不阻塞 DOM 的解析（绝大多数浏览器的工作方式）")])])]),t._v(" "),a("li",[t._v("3.优化核心理念：尽可能快的提高外部 css 加载速度\n"),a("ul",[a("li",[t._v("使用 CDN 节点进行外部资源加速")]),t._v(" "),a("li",[t._v("对 css 进行压缩（利用打包工具，比如 webpack，gulp 等）")]),t._v(" "),a("li",[t._v("减少 http 请求数，将多个 css 文件合并")]),t._v(" "),a("li",[t._v("优化样式表的代码")])])])]),t._v(" "),a("h3",{attrs:{id:"_2-关于-js-阻塞"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-关于-js-阻塞"}},[t._v("#")]),t._v(" 2.关于 js 阻塞")]),t._v(" "),a("ul",[a("li",[t._v("1.阻塞后续 DOM 解析：\n"),a("ul",[a("li",[t._v("原因：浏览器不知道后续脚本的内容，如果先去解析了下面的 DOM ， 而随后的 js 删除了后面所有的 DOM ， 那么浏览器就做了无用功，浏览器无法预估脚本里面具体做了什么操作，例如：document.write 这种操作，索性全部停住，等脚本执行完了，浏览器再继续向下解析 DOM。")])])]),t._v(" "),a("li",[t._v("2.阻塞页面渲染：\n"),a("ul",[a("li",[t._v("原因：js 中也可以给 DOM 设置样式，浏览器等该脚本执行完毕，渲染出一个最终的结果，避免做无用功。")])])]),t._v(" "),a("li",[t._v("3.阻塞后续 js 的执行：\n"),a("ul",[a("li",[t._v("原因：维护依赖关系，例如：必须先引入 jQuery 再引入 bootstrap")])])])]),t._v(" "),a("h4",{attrs:{id:"defer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#defer"}},[t._v("#")]),t._v(" defer")]),t._v(" "),a("p",[t._v("例：")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("index.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("index.js 文件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" div "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("会发生，无法获取 DOM 元素，因为 DOM 元素还未渲染，因为 js 进行了阻塞。"),a("br"),a("br"),t._v("\n解决方案 一")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 方案一")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" div "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 方案二")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOMContentLoaded"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" div "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("解析 DOMContentLoaded")]),t._v(" "),a("p",[t._v("当初始的 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，而无需等待样式表、图像和子框架的完全加载。")])]),t._v(" "),a("p",[t._v("解决方案 二")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("defer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("index.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("解析 defer")]),t._v(" "),a("p",[t._v("这个布尔值被设定用来通知浏览器该脚本在文档完成解析后，触发 DOMContentLoaded 事件前执行。"),a("br"),a("br"),t._v("\n有 defer 属性的脚本会阻止 DOMContentLoaded 事件，直到脚本被加载并且解析完成。")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("如果缺少 src 属性（即内嵌脚本），该属性不应被使用，因为这种情况下它不起作用。"),a("br"),t._v("\ndefer 属性对模块脚本没有作用 -- 他们默认 defer")])])])}),[],!1,null,null,null);s.default=e.exports}}]);